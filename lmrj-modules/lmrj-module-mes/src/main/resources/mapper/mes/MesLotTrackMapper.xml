<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lmrj.mes.track.mapper.MesLotTrackMapper" >

	<sql id="Base_Column_List" >
       t.id,
       t.eqp_id,
       t.lot_no,
       t.production_no,
       t.order_no,
       t.lot_yield,
       t.start_time,
       t.end_time,
       t.remarks,
       t.create_by,
       t.create_date,
       t.update_by,
       t.update_date,
       t.del_flag
	</sql>

       <!--<select id="findlotYield">-->

       <!--</select>-->
      <select id="findIncompleteLotNo" resultType="com.lmrj.mes.track.entity.MesLotTrack" parameterType="java.util.Date">
              select
                    *
              from
                    mes_lot_track
              where
                    (PRODUCTION_NO, LOT_NO, start_time ) in
                    (SELECT
                            PRODUCTION_NO, LOT_NO ,
                            max(start_time)
                    FROM
                            mes_lot_track
                    WHERE
                            ( PRODUCTION_NO, LOT_NO )  NOT IN
                            (select
                                    DISTINCT
                                    PRODUCTION_NO,
                                    LOT_NO
                            from
                                    mes_lot_track
                            where eqp_id LIKE '%STM-TRM%' AND END_TIME IS NOT NULL
                                   and create_date between #{startTime} and #{endTime}
                            )
                    and create_date  between #{startTime} and #{endTime}
                    group by PRODUCTION_NO,LOT_NO)
       </select>
</mapper>
